// (c) Copyright 2015 - 2023 Micro Focus or one of its affiliates..
/*
 * Created on 06/16/2016.
 */

var assert = require("assert");
var sinon = require("sinon");
var Core = require("leanft.sdk.core");
var MouseButton = Core.MouseButton;

describe("Menu Description", function () {

    var Menu = require("../lib/menu.js").Menu;
    var MenuType = require("../lib/menu.js").MenuType;
    var menuDescUnderTest;

    beforeEach(function () {
        menuDescUnderTest = Menu();
    });

    describe("type method", function () {
        it("should add 'menuobjtype' to _properties when value is given in enum", function () {
            menuDescUnderTest.type(MenuType.menu);
            assert.strictEqual(menuDescUnderTest._properties["menuobjtype"], 2);
        });

        it("should add 'menuobjtype' to _properties when value is given in string", function () {
            menuDescUnderTest.type("menu");
            assert.strictEqual(menuDescUnderTest._properties["menuobjtype"], 2);
        });

        it("should return this - builder pattern when value is given", function () {
            var result = menuDescUnderTest.type(MenuType.menu);
            assert.strictEqual(result, menuDescUnderTest);
        });

        it("should remove 'menuobjtype' from _properties when value is null", function () {
            menuDescUnderTest._properties["menuobjtype"] = 2;
            menuDescUnderTest.type(null);
            assert(!("menuobjtype" in menuDescUnderTest._properties));
        });

        it("should return the value of 'menuobjtype' from _properties when value is not given", function () {
            menuDescUnderTest._properties["menuobjtype"] = 2;
            var result = menuDescUnderTest.type();
            assert.equal(result, MenuType.menu);
        });
    });
    
});

describe("Menu Test Object", function () {

    var MenuTO = require("../lib/menu.js").MenuTO;
    var MenuItem = require("../lib/menu_item.js").MenuItem;
    var MenuType = require("../lib/menu.js").MenuType;
    var menuTOUnderTest;

    beforeEach(function () {
        menuTOUnderTest = new MenuTO();
        sinon.stub(menuTOUnderTest, "_executeWithEvents");
        sinon.stub(menuTOUnderTest, "_getROProperty");
        sinon.stub(menuTOUnderTest, "_executeNotWrapped");
    });

    afterEach(function () {
        menuTOUnderTest._executeWithEvents.restore();
        menuTOUnderTest._getROProperty.restore();
        menuTOUnderTest._executeNotWrapped.restore();
        
    });

    describe("getItem method", function () {
        it("should throw error if path is undefined", function () {
            assert.throws(function () {
                menuTOUnderTest.getItem();
            });
        });

        it("should throw error if path is null", function () {
            assert.throws(function () {
                menuTOUnderTest.getItem(null);
            });
        });

        it("should return the MenuItem", function () {
            var res = menuTOUnderTest.getItem("Item1");
            assert.strictEqual(res._path, "Item1");
            assert.deepEqual(res._ownerMenu, menuTOUnderTest);
        });
    });


    describe("select method", function () {
        it("should throw error if menuItem is undefined", function () {
            assert.throws(function () {
                menuTOUnderTest.select();
            });
        });

        it("should throw error if menuItem is null", function () {
            assert.throws(function () {
                menuTOUnderTest.select(null);
            });
        });

        it("should throw error if menuItem has no _path", function () {
            assert.throws(function () {
                menuTOUnderTest.select({});
            });
        });

        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeWithEvents.returns(executionPromise);
            var res = menuTOUnderTest.select("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeWithEvents 'Select' with the menu path", function () {
            menuTOUnderTest.select("Menu1;Menu2;");
            sinon.assert.calledOnce(menuTOUnderTest._executeWithEvents);
            sinon.assert.calledWith(menuTOUnderTest._executeWithEvents, sinon.match({ 0: "Menu1;Menu2;" }), "Select", "Menu1;Menu2;");
        });

        it("should execute _executeWithEvents 'Select' with the MenuItem", function () {
            var menuItem = { _path: "Menu1;Menu2;" };
            menuTOUnderTest.select(menuItem);
            sinon.assert.calledOnce(menuTOUnderTest._executeWithEvents);
            sinon.assert.calledWith(menuTOUnderTest._executeWithEvents, sinon.match({ 0: menuItem }), "Select", "Menu1;Menu2;");
        });
    });    

    describe("type method", function () {
        it("should return the MenuType", function () {
            var executionPromise = { then: function (cb) { return cb(2); } };
            menuTOUnderTest._getROProperty.returns(executionPromise);
            var res = menuTOUnderTest.type();
            assert.equal(res, MenuType.menu);
        });

        it("should execute _getROProperty 'menuobjtype' with correct menuobjtype", function () {
            var executionPromise = { then: function (cb) { return cb(2); } };
            menuTOUnderTest._getROProperty.returns(executionPromise);
            menuTOUnderTest.type();
            sinon.assert.calledOnce(menuTOUnderTest._getROProperty);
            sinon.assert.calledWith(menuTOUnderTest._getROProperty, "menuobjtype", sinon.match({}));
        });
    });

    describe("_getItemLabel method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._getItemLabel("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._getItemLabel("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "Label");
        });
    });

    describe("_isItemChecked method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._isItemChecked("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._isItemChecked("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "Checked");
        });
    });

    describe("_isItemEnabled method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._isItemEnabled("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._isItemEnabled("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "Enabled");
        });
    });

    describe("_isItemExists method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._isItemExists("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._isItemExists("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "Exists");
        });
    });

    describe("_itemHasSubMenu method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._itemHasSubMenu("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._itemHasSubMenu("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "HasSubMenu");
        });
    });

    describe("_getItemIndex method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._getItemIndex("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._getItemIndex("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "Index");
        });
    });

    describe("_getItemSubMenuCount method", function () {
        it("should return the execution promise", function () {
            var executionPromise = {};
            menuTOUnderTest._executeNotWrapped.returns(executionPromise);
            var res = menuTOUnderTest._getItemSubMenuCount("MenuItem");
            assert.equal(res, executionPromise);
        });

        it("should execute _executeNotWrapped 'GetItemProperty' with correct parameters", function () {
            menuTOUnderTest._getItemSubMenuCount("MenuItem");
            sinon.assert.calledOnce(menuTOUnderTest._executeNotWrapped);
            sinon.assert.calledWith(menuTOUnderTest._executeNotWrapped, sinon.match({ 0: "MenuItem" }), "GetItemProperty", "MenuItem", "SubMenuCount");
        });
    });

    ["getVisibleText", "getTextLocations"].forEach(function (unsupportedFunc) {
       describe(unsupportedFunc + " method", function () {
           it("should throw error", function () {
               var expectedErr = unsupportedFunc + " function is not supported for the menu test object.";
               assert.throws(function () {
                   menuTOUnderTest[unsupportedFunc]();
               }, new RegExp(expectedErr));
           });
       });
    });
});

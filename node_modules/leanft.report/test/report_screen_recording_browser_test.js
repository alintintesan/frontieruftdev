/**
 * Created by diamanta on 11/10/2015.
 */
var LFT = require("../../leanft");
var SDK = LFT.SDK;
var Web = LFT.Web;

var expect = require("../../leanft/expect");
//var Reporter = require("../../leanft/report");

var browserTypeToTest = Web.BrowserType.Firefox;

var browser;

jasmine.DEFAULT_TIMEOUT_INTERVAL = 120 * 1000;

xdescribe("Test Report Browser", function () {

    beforeEach(function (done) {
        LFT.SDK.init();
        LFT.init();
        LFT.whenDone(done);
    });

    it("Start screen recording", function (done) {
        LFT.Reporter.reportEvent("Start screen recording");
        LFT.Reporter.startScreenRecording().then(function () {
            Web.Browser.launch(browserTypeToTest).then(function (b) {
                browser = b;

                browser.navigate("http://lnz-testsite");
                
                browser.$(Web.Link({
                    innerText: "AdvantageDEMO",
                    tagName: "A"
                })).click();

                browser.$(Web.Link().innerText("POPULAR ITEMS")).exists().then(function (resExistTrue) {
                    sleep(3000)
                    browser.$(Web.Link({
                        innerText: "POPULAR ITEMS",
                        tagName: "A"
                    })).click();
                })
                LFT.whenDone(done);
            });
        });
    });

    afterEach(function (done) {
        sleep(3000)
        LFT.Reporter.reportEvent("Stop screen recording");
        LFT.Reporter.stopScreenRecording();

        if (browser) {
            browser.exists(2).then(function (resexist) {
                if (resexist)
                    browser.closeAllTabs();
            });
        }
        SDK.cleanup();

        LFT.whenDone(done);
    });


    function sleep(ms) {
        var time_ms = new Date().getTime();
        while (new Date().getTime() < time_ms + ms) { }
    }
});





